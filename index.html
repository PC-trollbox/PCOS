<!DOCTYPE HTML>

<html lang="en">

<head>

    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1">

    <title>PCOS - superbeta</title>

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	
	<link rel="stylesheet" href="css/bootstrap.min.css">
<script src="js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <style>
	.ui-menu { width: 150px; }
       .footer {

           position: fixed;

           left: 0;

           bottom: 0;

           width: 100%;

       }

       footcen {

           position: fixed;

           left: 0;

           bottom: 0;

           width: 100%;

           text-align: center;

       }

       centeralize {

           border-radius: 1em;

           padding: 1em;

           position: absolute;

           top: 50%;

           left: 50%;

           margin-right: -50%;

           transform: translate(-50%, -50%)
       }
    </style>

</head>

<body style="background: black; color: white; font-family: monospace;" autofocus>

    <centeralize>

        </strong>PC laptop<strong>

    </centeralize>

    <script type="text/javascript">
setTimeout(function() {

    username = "NT AUTHORITY/SYSTEM"
	users = JSON.parse(localStorage.getItem("users")) || undefined
    apps = JSON.parse(localStorage.getItem("apps")) || {

        "shutdown": {

            company: "PCsoft",

            "function": 'osevents.emit("shutoff", "")'

        }

    }

    osevents = {

        on: function(event, callback) {

            if (typeof event !== "string" && typeof callback !== "function") return "Cannot handle the event callback for the event '" + event + "'."

            if (this.eventHandlers[event] == undefined) this.eventHandlers[event] = []

            this.eventHandlers[event].push(callback)

            return "Handled the event callback for '" + event + "' successfully!"

        },

        emit: function(event, args) {

            if (typeof event !== "string" || args === undefined) return "Cannot emit the event '" + event + "'."

            for (ev in this.eventHandlers[event]) {

                this.eventHandlers[event][ev](args);

            }

            return "Emitted the event '" + event + "' successfully!"

        },

        eventHandlers: {

            shutoff: [function() {

                new uiwindow({

                    nme: "shutdown",

                    title: "PCOS is shutting down",

                    content: "PCOS is shutting down in 30 seconds.<br>Please save all your data and leave the session.<br><br><b>Shutdown initiated by \"" + username + "\" at " + new Date() + ".</b>"

                })

                setTimeout(function() {

                    document.body.innerHTML = "It is now safe to turn off your computer.";

                    document.body.style = "color: white; background: black; font-family: monospace"

                }, 30000)

}],

            startmenu:

		[

		function() {

                        var cntnt = "PCOS Start Menu<br>Add apps using JS.<br>"

										menuhandler.innerHTML = `<ul id="menumenu">${username}
  <li><div>Programs</div>
    <ul id=gu>
    </ul>
  </li>
  <li onclick="location.reload()"><div>Reboot the system</div></li>
  <li onclick="osevents.emit('shutoff', {}); startyemenu.disabled=true; this.className = this.className + ' ui-state-disabled '"><div>Turn off the system</div></li>
  <li id="idiotist" class="ui-state-disabled" onclick="osevents.emit('logoff', {})" disabled><div>Log out from the system</div></li>
<li onclick="menuhandler.innerHTML = ''"><div>Close menu</div></li>
</ul>`
										if (username !== "NT AUTHORITY/SYSTEM"){
											idiotist.disabled = false;
											idiotist.className = "ui-menu-item";
										}
			
                        for (var app in apps) {
				
                            gu.innerHTML = gu.innerHTML + '<li onclick="try{eval(apps[\'' + app + '\'].function); menuhandler.innerHTML=\'\'}catch(e){alertbug(e)}"><div><label>'+app+'</label></li></div>'

                        }
			
				$("#menumenu").menu()
                        /*new uiwindow({

                            nme: "start",

                            title: "Start menu",

                            left: 1,

                            top: 508,

                            width: 258,

                            height: 107,

                            content: cntnt

                        })*/

		}

		]

        }

    }

    alertbug = function(e) {

        var idiot = 0;

        var hash = 0;

        if (e.stack.length == 0) {

            return hash;

        }

        for (var i = 0; i < e.stack.length; i++) {

            var char = e.stack.charCodeAt(i);

            idiot = ((idiot << 5) - idiot) + char;

            idiot = idiot & idiot; // Convert to 32bit integer

        }

        new uiwindow({

            nme: "errrep",

            title: "Error occured!",

            content: "The following error occured:<br><b>" + e.stack.replace("\n", "<br>") + "</b><br><br>It is an error in running the developer's program or the system error.<br>Please contact everyone who can code, the developer of the program and/or PCsoft.<br>They will help you with this error.<br>ERROR ID: <b>" + idiot.toString(18).substring(2) + "</b><button onclick='errrep.remove()'>Close</button>"

        })

    }

    uiwindow = class uiwindow {

        constructor(settings) {

            if (typeof settings !== "object") throw new Error("Made settings an object.")

            if (typeof settings.nme !== "string") throw new Error("Make name a string.")

            if (typeof settings.title !== "string") throw new Error("Make title a string.")

            if (typeof settings.content !== "string") throw new Error("Make content a string.")

            var div = document.createElement("div")
	    
            div.id = settings.nme;
		
	    div.title = settings.title;
		
	    div.innerHTML = settings.content;
		
            desktop.appendChild(div);

		$("#"+settings.nme).dialog()
        }

    }
if (users !== undefined){
	go = function(){
		document.body.innerHTML = '<div id="desktop"></div><div id="min" class="footer"><label id="menuhandler"></label><br><button type="button" class="btn btn-secondary" id=startyemenu>PC</button></div>'

    document.body.style = "background: deepskyblue"

    startyemenu.onclick = function() {

        osevents.emit('startmenu', '')
    }
    eval(localStorage.getItem("afterboot.js"))
		go = undefined;
		osevents.on("logoff",function(){
			document.body.innerHTML = "<centeralize>Goodbye...</centeralize>"
			setTimeout(function(){
				location.reload()
			}, 2000)
		})
	}
	input = ""
	document.body.innerHTML = 'PCOS boot login<br><br>Username: '
	onkeypress = function(e){
if (e.isTrusted){
if (e.code == "Pause") return;
if (e.key == "Enter"||e.code == "Enter"){
	if (users[input] == undefined) {
		document.body.innerHTML = document.body.innerHTML + "<br>No such username.<br><br>Username: "
		input = ""
return;
	}
	if (users[input] != undefined && users[input].password){
		document.body.innerHTML = document.body.innerHTML + "<br>Password: "
		username = input;
		input = "";
		onkeypress = function(e){
if (e.isTrusted){
if (e.code == "Pause") return;
if (e.key == "Enter"||e.code == "Enter"){
	if (input == ""){
	document.body.innerHTML = document.body.innerHTML + "<br>Enter your login password."
	onkeypress = null
	input = "";
	setTimeout(function(){location.reload()}, 2000);
return;
}
	if (users[username].password == input){
		go()
		input = "";
	}else{
			document.body.innerHTML = document.body.innerHTML + "<br>Incorrect password"
	onkeypress = null
	input = "";
		setTimeout(function(){location.reload()}, 2000);
	}
}
input = input + e.key;
}
}
}
	}
if (input == ""){
	document.body.innerHTML = document.body.innerHTML + "<br>Enter your login data.<br><br>Username: "
	input = "";
return;
}
}
input = input + e.key;
document.body.innerText = document.body.innerText + e.key;
		return
}
    document.body.innerHTML = '<div id="desktop"></div><div id="min" class="footer"><label id="menuhandler"></label><br><button type="button" class="btn btn-secondary" id=startyemenu>PC</button></div>'

    document.body.style = "background: deepskyblue"

    startyemenu.onclick = function() {

        osevents.emit('startmenu', '')

    }

    eval(localStorage.getItem("afterboot.js"))

}, 5000)

setTimeout(function() {

    eval(localStorage.getItem("onboot.js"))

    document.body.innerHTML = ""

    document.body.innerHTML = `	   <centeralize>

		   </strong>PC laptop<strong>

	   </centeralize><footcen><progress></progress><br>Powered by <strong>PCOS</strong></footcen>`

}, 3000)
    </script>

</body>

</html>
